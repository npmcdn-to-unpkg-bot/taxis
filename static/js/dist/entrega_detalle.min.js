"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};$(document).ready(function(){var Buttons=React.createClass({displayName:"Buttons",handleDeleteConceptoClick:function handleDeleteConceptoClick(event){event.preventDefault();$.ajaxSetup({headers:{"X-CSRFToken":getCookie("csrftoken")}});$.post(this.props.url_delete,{id_concept:this.props.concept_id});this.props.get_data_f()},handleDeleteEntregaClick:function handleDeleteEntregaClick(event){event.preventDefault();$.ajaxSetup({headers:{"X-CSRFToken":getCookie("csrftoken")}});$.post(this.props.url_delete,{id_ent:this.props.ent_id});this.props.get_data_f()},handleAceptarEntregaClick:function handleAceptarEntregaClick(event){event.preventDefault();$.ajaxSetup({headers:{"X-CSRFToken":getCookie("csrftoken")}});$.post(this.props.url_estado_token,{id_ent:this.props.ent_id,tipo_update:"siguiente_estado"});this.props.get_data_f()},handleTokenClick:function handleTokenClick(event){event.preventDefault();var token=event.target.num_token.value;$.ajaxSetup({headers:{"X-CSRFToken":getCookie("csrftoken")}});$.post(this.props.url_estado_token,{id_ent:this.props.ent_id,num_token:token,tipo_update:"validar_token"});this.props.get_data_f()},render:function render(){switch(this.props.buttonType){case"DeleteConcepto":return React.createElement("a",{type:"submit",onClick:this.handleDeleteConceptoClick,className:"fa fa-trash fa-2x"});case"DeleteEntrega":return React.createElement("a",{type:"submit",onClick:this.handleDeleteEntregaClick,className:"fa fa-trash fa-2x"});case"AceptarEntrega":return React.createElement("a",{type:"submit",onClick:this.handleAceptarEntregaClick,className:"fa fa-check-square-o fa-2x"});case"Token":return React.createElement("div",{className:"row"},React.createElement("form",{onSubmit:this.handleTokenClick,action:"."},React.createElement("div",{className:"col-xs-9"},React.createElement("input",{className:"form-control",name:"num_token",type:"number"})),React.createElement("div",{className:"col-xs-2 col-xs-offset-1"},React.createElement("button",{type:"submit",className:"fa fa-check-square-o fa-2x "}))));default:return"#FFFFFF"}}});var RowItem=React.createClass({displayName:"RowItem",render:function render(){var deleteButton;var get_data_f=this.props.get_data_f;if(this.props.editable){deleteButton=React.createElement("td",null,React.createElement(Buttons,{get_data_f:get_data_f,url_delete:this.props.url_delete,buttonType:"DeleteConcepto",concept_id:this.props.concept_id}))}else{deleteButton=null}return React.createElement("tr",null,React.createElement("td",null,this.props.fecha),React.createElement("td",null,this.props.tipo),React.createElement("td",{style:this.props.es_ingreso?{color:"black"}:{color:"red"}},this.props.valor),deleteButton)}});var ConceptosTable=React.createClass({displayName:"ConceptosTable",render:function render(){var edit=this.props.editable;var conceptos=this.props.conceptos;var get_data_f=this.props.get_data_f;return React.createElement("div",null,React.createElement("h2",null,"Conceptos"),React.createElement("h5",null,React.createElement("table",{className:"table table-striped col-xs-12"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("td",null,"Fecha"),React.createElement("td",null,"Tipo"),React.createElement("td",null,"Valor"))),React.createElement("tbody",null,conceptos.map(function(l){return React.createElement(RowItem,{key:l.pk,fecha:l.fecha,tipo:l.tipo,valor:l.valor,es_ingreso:l.es_ingreso,concept_id:l.pk,url_delete:l.url_delete,editable:edit,get_data_f:get_data_f})})),React.createElement("tfoot",null,React.createElement("tr",{style:{color:"blue"}},React.createElement("td",{colSpan:"2",className:"text-center"},"Ingreso"),React.createElement("td",null,this.props.ingreso)),React.createElement("tr",{style:{color:"red"}},React.createElement("td",{colSpan:"2",className:"text-center"},"Gasto"),React.createElement("td",null,this.props.gasto)),React.createElement("tr",{style:{color:"white",background:"black"}},React.createElement("td",{colSpan:"2",className:"text-center"},"Total"),React.createElement("td",null,this.props.total))))))}});var EntregaDetailInfo=React.createClass({displayName:"EntregaDetailInfo",render:function render(){var deleteButton=null;if(this.props.entrega_editable){deleteButton=React.createElement(Buttons,{buttonType:"DeleteEntrega",get_data_f:this.props.get_data_f,url_delete:this.props.url_delete,ent_id:this.props.ent_id})}var aceptarButton=null;if(this.props.mostrar_boton_aceptar){aceptarButton=React.createElement(Buttons,{buttonType:"AceptarEntrega",get_data_f:this.props.get_data_f,url_estado_token:this.props.url_estado_token,ent_id:this.props.ent_id})}var panelToken=null;if(this.props.pedit_token){panelToken=React.createElement(Buttons,{buttonType:"Token",get_data_f:this.props.get_data_f,url_estado_token:this.props.url_estado_token,ent_id:this.props.ent_id})}var quienTieneEntrega=null;if(this.props.mostrar_quien_tiene_entrega){quienTieneEntrega=React.createElement("p",null,React.createElement("span",null,"Tiene la entrega: "),React.createElement("small",null,React.createElement("span",{className:"lead"}," ",this.props.persona_entrega," ")))}var token=null;if(this.props.mostrar_token){token=React.createElement("p",null,React.createElement("span",null,"Clave Entrega: "),React.createElement("small",null,React.createElement("span",{className:"lead"}," ",this.props.token," ")))}return React.createElement("div",null,React.createElement("h1",null,"Entrega",React.createElement("small",null,React.createElement("span",{className:"lead",style:{color:"indianred"}}," ",this.props.estado," "))),React.createElement("h4",null,React.createElement("p",null,React.createElement("span",null,"Taxi: "),React.createElement("small",null,React.createElement("span",{className:"lead"}," ",this.props.taxi,"  "))),React.createElement("p",null,React.createElement("span",null,"Fecha de entrega: "),React.createElement("small",null,React.createElement("span",{className:"lead"}," ",this.props.fecha,"  "))),React.createElement("p",null,React.createElement("span",null,"Conductor: "),React.createElement("small",null,React.createElement("span",{className:"lead"}," ",this.props.conductor," "))),React.createElement("p",null,React.createElement("span",null,"Entrega ($): "),React.createElement("small",null,React.createElement("span",{className:"lead"}," ",this.props.total," "))),quienTieneEntrega,token),React.createElement("div",null,panelToken),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-6 "},deleteButton),React.createElement("div",{className:"col-xs-6 text-right"},aceptarButton)))}});var EntregaDetailPanel=React.createClass({displayName:"EntregaDetailPanel",mixins:[SetIntervalMixin],shouldComponentUpdate:function shouldComponentUpdate(nextProps,nextState){return nextState.ultimo_update_entrega_fecha!=this.state.ultimo_update_entrega_fecha},getInitialState:function getInitialState(){return{ent_id:this.props.ent_id,estado:"",taxi:"",fecha:"",conductor:"",token:"",persona_entrega:"",entrega_editable:false,mostrar_token:false,pedit_token:false,mostrar_quien_tiene_entrega:false,siguiente_estado:false,mostrar_boton_aceptar:false,total:0,ingreso:0,gasto:0,conceptos:[],ultimo_update_entrega_fecha:"",url_delete:"",url_estado_token:""}},componentDidMount:function componentDidMount(){this.loadCommentsFromServer();setInterval(this.loadCommentsFromServer,5e3)},loadCommentsFromServer:function loadCommentsFromServer(){$("#spinner").show();$.get(".",{ent_id:this.props.ent_id,ultimo_update_entrega_fecha:this.state.ultimo_update_entrega_fecha,dataType:"json"},function(data){var parced_data=JSON.parse(data);var new_fecha=parced_data.ultimo_update_entrega_fecha;$("#spinner").hide();if(new_fecha!=this.state.ultimo_update_entrega_fecha){this.setState({estado:parced_data.estado,taxi:parced_data.taxi,fecha:parced_data.fecha,token:parced_data.token,conductor:parced_data.conductor,persona_entrega:parced_data.persona_entrega,mostrar_token:parced_data.mostrar_token,pedit_token:parced_data.pedit_token,mostrar_quien_tiene_entrega:parced_data.mostrar_quien_tiene_entrega,siguiente_estado:parced_data.siguiente_estado,mostrar_boton_aceptar:parced_data.mostrar_boton_aceptar,entrega_editable:parced_data.entrega_editable,total:parced_data.valor,ingreso:parced_data.ingreso,gasto:parced_data.gasto,conceptos:parced_data.conceptos,ultimo_update_entrega_fecha:parced_data.ultimo_update_entrega_fecha,url_delete:parced_data.url_delete,url_estado_token:parced_data.url_estado_token});this.state.entrega_editable?$("#div_conceptos").show("slow"):$("#div_conceptos").hide("slow")}}.bind(this)).done(function(){}).fail(function(){})},render:function render(){return React.createElement("div",{id:"panel_entrega",className:"row"},React.createElement("div",{id:"spinner",className:"spinner"},React.createElement("i",{className:"fa fa-spinner fa-5x"})),React.createElement("div",{className:"col-xs-10 col-sm-4 col-xs-offset-1"},React.createElement(EntregaDetailInfo,_extends({},this.state,{get_data_f:this.loadCommentsFromServer}))),React.createElement("div",{className:"col-xs-10 col-sm-6 col-xs-offset-1 col-sm-offset-0"},React.createElement(ConceptosTable,{get_data_f:this.loadCommentsFromServer,ent_id:this.props.ent_id,editable:this.state.entrega_editable,total:this.state.total,gasto:this.state.gasto,ingreso:this.state.ingreso,conceptos:this.state.conceptos})))}});var id_entrega=$("#entrega-id").val();ReactDOM.render(React.createElement(EntregaDetailPanel,{ent_id:id_entrega}),document.getElementById("detalle-entrega"))});